<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
    	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    	<!--Fonts-->
		<link href='http://fonts.googleapis.com/css?family=Oxygen:400,300,700' rel='stylesheet' type='text/css'>
		<link href='http://fonts.googleapis.com/css?family=Oswald:400,300,700' rel='stylesheet' type='text/css'>

        <!--jQuery, required for some functions of Bootstrap-->
        <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>

        <!--Bootstrap v3, retrieved from a third party CDN-->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap-theme.min.css">
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>

        <!--Pace.js and associated stylesheet-->
        <script src="../static/js/pace.min.js"></script>
        <link rel="stylesheet" href="../static/css/pace.css">
        <script src="../static/js/splash-fade.js"></script>

        <!--Date Time Picker-->
        <link rel="stylesheet" href="../static/css/bootstrap-datetimepicker.css">
        <script type="text/javascript" src="http://momentjs.com/downloads/moment.js"></script>
        <script type="text/javascript" src="static/js/bootstrap-datetimepicker.min.js"></script>

		<!--Roommate Finder stylesheet-->
		<link type="text/css" rel="stylesheet" href="../static/stylesheet.css">

        <title>my profile | roommate finder | rice university</title>

        <!--Override some CSS properties-->
		<style type="text/css">
            body {
                background: #F5F5F5;
                margin-top: 180px;
                margin-bottom: 150px;
            }
            .hidden {
  				visibility: hidden;
  				opacity: 0;
			}
            .visible {
  				visibility: visible;
  				opacity: 1;
			}
            #content {
                margin-left: 10%;
            }
            #preview {
                max-width: 150px;
                max-height: 150px;
            }
            #facebooklogin {
                position: absolute;
                max-width: 20%;
                left: 65%;
            }
            img.preview {
                max-width: 150px;
                max-height: 150px;
            }
            p.heading {
                font-family: 'Oxygen', sans-serif;
				font-weight: 300;
				letter-spacing: 1px;
                line-height: 70px;
				font-size: 70px;
				color: #171717;
            }
            p.subheading {
                font-family: 'Oswald', sans-serif;
				font-weight: 300;
				letter-spacing: 1px;
				font-size: 20px;
				color: #171717;
            }
            p.fieldname {
				font-family: 'Oxygen', sans-serif;
				font-weight: 300;
				letter-spacing: 1px;
                line-height: 1px;
				font-size: 14px;
				color: #171717;
			}
            p.text {
				font-family: 'Oxygen', sans-serif;
				font-weight: 300;
				letter-spacing: 1px;
				font-size: 14px;
				color: #171717;
			}
            p.sectionheading {
                font-family: 'Oswald', sans-serif;
				font-weight: 400;
				letter-spacing: 1px;
				font-size: 19px;
				color: #171717;
            }
            p.button {
				font-family: 'Oxygen', sans-serif;
				font-weight: 400;
				letter-spacing: 1px;
                line-height: 18px;
				font-size: 20px;
				color: #EDEDED;
			}
            p.facebook {
				font-family: 'Oxygen', sans-serif;
				font-weight: 300;
				letter-spacing: 1px;
				font-size: 20px;
				color: #171717;
			}
            p.error {
				font-family: 'Oxygen', sans-serif;
				font-weight: 400;
				letter-spacing: 1px;
                line-height: 1px;
				font-size: 20px;
				color: #CC2323;
			}
            span.pagesection {
				font-family: 'Oxygen', sans-serif;
				font-weight: 300;
				letter-spacing: 1px;
				font-size: 13px;
				color: #EDEDED;
			}
            span.pagesectionbold {
				font-family: 'Oxygen', sans-serif;
				font-weight: 700;
				letter-spacing: 1px;
				font-size: 13px;
				color: #EDEDED;
			}
            #darklink a:link {
				color: #17657A;
				text-decoration: none;
			}
			#darklink a:hover {
				color: #318FA8;
				text-decoration: none;
				border-bottom: 2px solid #318FA8;
			}
			#darklink a:visited {
				color: #17657A;
				text-decoration: none;
			}
			#darklink a:active {
				color: #17657A;
				text-decoration: none;
			}
            #delete a:link {
				color: #CC2323;
				text-decoration: none;
			}
			#delete a:hover {
				color: #9E0E0E;
				text-decoration: none;
				border-bottom: 2px solid #9E0E0E;
			}
			#delete a:visited {
				color: #CC2323;
				text-decoration: none;
			}
			#delete a:active {
				color: #CC2323;
				text-decoration: none;
			}
        </style>

        <!--Javascript-->
        <script type="text/javascript">
            function handleFiles(files) {
                // Get existing image, if exists
                var oldImage = document.getElementById("preview");
                // Remove it from the div (so to replace it with the new image)
                while (oldImage.firstChild) {
                    oldImage.removeChild(oldImage.firstChild);
                }
                // Get the image selected by the user
                var file = files[0];
                var img = document.createElement("img");
                img.classList.add("preview");
                img.file = file;
                // Add it to the div preview
                preview.appendChild(img); // Assuming that "preview" is a the div output where the content will be displayed.
                // Load image
                var reader = new FileReader();
                reader.onload = (function(aImg) { return function(e) { aImg.src = e.target.result; }; })(img);
                reader.readAsDataURL(file);
            }
        </script>

        <!--Facebook integration JS-->
        <script>
            function statusChangeCallback(response) {
                if (response.status === 'connected') {
                    importData()
                }
            }

            function checkLoginState() {
                FB.getLoginStatus(function (response) {
                    statusChangeCallback(response);
                });
            }

            window.fbAsyncInit = function () {
                FB.init({
                    appId: '1516541918613824', // App ID registered: Rice Roommate Finder
                    cookie: true,
                    xfbml: true,
                    version: 'v2.1'
                });

                FB.getLoginStatus(function (response) {
                    statusChangeCallback(response);
                });
            };

            // Load the SDK asynchronously
            (function (d, s, id) {
                var js, fjs = d.getElementsByTagName(s)[0];
                if (d.getElementById(id)) return;
                js = d.createElement(s);
                js.id = id;
                js.src = "//connect.facebook.net/en_US/sdk.js";
                fjs.parentNode.insertBefore(js, fjs);
            }(document, 'script', 'facebook-jssdk'));

            function importData() {
                FB.api('/me', function (response) {
                    // Console debug log
                    console.log("Facebook login success. Full response: " + JSON.stringify(response));

                    // Set ID
                    document.getElementById("facebook").value = response.id;

                    // Reveal link to grab profile picture from Facebook
                    document.getElementById("getfacebookpicture").className = "visible";

                    // Change the Facebook login box to show completion of login
                    document.getElementById("facebooklogin").innerHTML = "<div id=\"darklink\"><p class=\"facebook\">You've connected your Facebook account! If you want to disconnect your Facebook account, <a onclick=\"disconnectFacebook();\" href=\"javascript:void(0);\">click here</a>.</p></div>";
                });
            }
        </script>

        <!--Custom Facebook integration functions-->
        <script type="text/javascript">
            // As the name implies, this is an onclick handler for pulling the user's profile image from Facebook.
            function getFacebookProfilePicture() {
                FB.api('/me/picture', {"redirect": false, "type": "large"}, function (response) {
                        // Secretly (as in, the URL is visually hidden to the user) record URL of profile picture
                        document.getElementById("facebook_photo").value = response.data.url;
                        var oldImage = document.getElementById("preview");
                        while (oldImage.firstChild) {
                            oldImage.removeChild(oldImage.firstChild);
                        }

                        // Update image preview
                        var img = document.createElement("img");
                        img.classList.add("preview");
                        img.src = response.data.url;
                        // Add it to the div preview
                        preview.appendChild(img);

                        // Clear file input, if exists
                        $("#photo_upload").replaceWith($("#photo_upload").val('').clone(true));
                    });
            }

            function disconnectFacebook() {
                    document.getElementById("facebook").value = "";
                    document.getElementById("facebooklogin").innerHTML = "<p class=\"facebook\">You've unlinked your Facebook account. Make sure to update your profile to save these changes.</p>";
                    FB.logout(function (response) {
                        console.log("Facebook logout success. Full response: " + JSON.stringify(response))
                    });
                    document.getElementById("getfacebookpicture").className = "hidden";
                }
        </script>

        <!--Bootstrap tooltips-->
        <script type="text/javascript">
            $(document).ready(function () {
                $('#dob').tooltip({'trigger': 'focus', 'title': 'We require your date of birth in order to determine your age. It will be hidden to other users.'});
            });
        </script>

        <!--Filler/joiner radio button selector-->
        <script type="text/javascript">
            $(function (ready) {
                $(document).ready(function () {
                    {% if data.profile.account_type == "filler" %}
                        $("#radiofiller").prop("checked", true);
                        // Change asterisks
                        document.getElementById("yearheader").innerHTML = "Year*";
                        document.getElementById("dobheader").innerHTML = "Date of birth*";
                        document.getElementById("genderheader").innerHTML = "Gender*";
                        document.getElementById("collegeheader").innerHTML = "College*";

                        // Change required attribute
                        document.getElementById("year").required = true;
                        document.getElementById("dob").required = true;
                        document.getElementById("gender").required = true;
                        document.getElementById("college").required = true;
                    {% else %}
                        $("#radiojoiner").prop("checked", true);
                        // Change asterisks
                        document.getElementById("yearheader").innerHTML = "Year";
                        document.getElementById("dobheader").innerHTML = "Date of birth";
                        document.getElementById("genderheader").innerHTML = "Gender";
                        document.getElementById("collegeheader").innerHTML = "College";

                        // Change required attribute
                        document.getElementById("year").required = false;
                        document.getElementById("dob").required = false;
                        document.getElementById("gender").required = false;
                        document.getElementById("college").required = false;
                    {% endif %}
                });
            });
        </script>

        <!--Filler/joiner radio button event listeners-->
        <script type="text/javascript">
            $(function(ready) {
                $(document).ready(function () {
                    $("#radiojoiner").change(function () {
                        // Change asterisks
                        document.getElementById("yearheader").innerHTML = "Year";
                        document.getElementById("dobheader").innerHTML = "Date of birth";
                        document.getElementById("genderheader").innerHTML = "Gender";
                        document.getElementById("collegeheader").innerHTML = "College";

                        // Change required attribute
                        document.getElementById("year").required = false;
                        document.getElementById("dob").required = false;
                        document.getElementById("gender").required = false;
                        document.getElementById("college").required = false;
                    });
                    $("#radiofiller").change(function () {
                        // Change asterisks
                        document.getElementById("yearheader").innerHTML = "Year*";
                        document.getElementById("dobheader").innerHTML = "Date of birth*";
                        document.getElementById("genderheader").innerHTML = "Gender*";
                        document.getElementById("collegeheader").innerHTML = "College*";

                        // Change required attribute
                        document.getElementById("year").required = true;
                        document.getElementById("dob").required = true;
                        document.getElementById("gender").required = true;
                        document.getElementById("college").required = true;
                    });
                });
            });
        </script>

        {% if data.profile.facebook %}
            <script type="text/javascript">
                $(document).ready(function() {
                    document.getElementById("facebooklogin").innerHTML = "<div id=\"darklink\"><p class=\"facebook\">You've connected your Facebook account! If you want to disconnect your Facebook account, <a onclick=\"disconnectFacebook();\" href=\"javascript:void(0);\">click here</a>.</p></div>";
                });
            </script>
        {% endif %}
	</head>

	<body>
        <div id="splash" class="visible">
            <div id="splashlogo">
                <img src="../static/graphics/logo_text_invert.png" width="600px" height="120px" />
            </div>
        </div>

		<div id="headercontainer">
            <table width="100%" height="60px">
                <tr>
                    <td width="10%"></td>
                    <td width="30%" valign="middle">
                        <a href="../"><img src="../static/graphics/logo.png" width="300px" height="60px" border="0" /></a>
                    </td>
                    <td width="50%" valign="bottom">
                        <div id="links"><p align="right">WELCOME, {{ data.profile.name.split(" ")[0] | upper}} | <a href="/search">FIND ROOMMATES</a> | <a href="/create_listing">CREATE A NEW LISTING</a> | <a href="/my_profile">MY ACCOUNT</a> | <a href="/logout">LOGOUT</a></p></div>
                    </td>
                    <td width="10%"></td>
                </tr>
            </table>
		</div>
        <div id="headercontainer2">
			<div id="header">
            	<div id="links"><p><a href="/my_profile"><span class="pagesectionbold">MY PROFILE</span></a> · <a href="/my_postings"><span class="pagesection">MY POSTINGS</span></a> · <a href="/delete_account"><span class="pagesection">DELETE MY ACCOUNT</span></a></p></div>
			</div>
		</div>

        <div id="content">
            <p class="heading">my profile</p>
            <div id="darklink"><p class="subheading">Edit your profile (<a href="/user/{{ data.profile.net_id }}">View your public profile</a>)</p></div>
            <br/><br/><br/>
            {% if data.error %}
                <p class="error">{{ data.error }}</p><br/><br/>
            {% endif %}
            <p class="sectionheading">PROFILE INFORMATION</p>
            <table width="60%">
                <tr>
                    <td>
                        <p class="text">Enter your profile information here. We strongly recommend you fill this out with as much detail as possible, so that it is easier for potential roommates to find you. Fields marked with an asterisk are required.</p>
                    </td>
                </tr>
            </table>
            <br/>
            <form action="/update_profile" method="POST" enctype="multipart/form-data" autocomplete="off">

                <table width="60%">

                    <tr height="20px"></tr>
                    <tr>
                        <td width="150px" valign="middle">
                            <p class="fieldname">Apartment name*</p>
                        </td>
                        <td>
                            <input class="form-control" type="text" id="apartment_name" name="apartment_name" value="{{ data.listing.apartment_name }}" required>
                        </td>
                    </tr>

                    <tr height="20px"></tr>
                    <tr>
                        <td width="150px" valign="middle">
                            <p class="fieldname">Address line 1*</p>
                        </td>
                        <td>
                            <input class="form-control" type="text" id="address_line_1" name="address_line_1" value="{{ data.listing.address_line_1 }}" required>
                        </td>
                    </tr>

                    <tr height="20px"></tr>
                    <tr>
                        <td width="150px" valign="middle">
                            <p class="fieldname">Address line 2*</p>
                        </td>
                        <td>
                            <input class="form-control" type="text" id="address_line_2" name="address_line_2" value="{{ data.listing.address_line_2 }}" required>
                        </td>
                    </tr>

                    <tr height="20px"></tr>
                    <tr>
                        <td width="150px" valign="middle">
                            <p class="fieldname">Distance (miles)*</p>
                        </td>
                        <td>
                            <input class="form-control" type="number" id="address_line_2" name="address_line_2" value="{{ data.listing.distance }}" required>
                        </td>
                    </tr>

                    <tr height="20px"></tr>
                    <tr>
                        <td width="150px" valign="middle">
                            <p class="fieldname">Rent ($/month)*</p>
                        </td>
                        <td>
                            <input class="form-control" type="number" id="address_line_2" name="address_line_2" value="{{ data.listing.distance }}" required>
                        </td>
                    </tr>

                    <tr height="20px"></tr>
                    <tr>
                        <td width="150px" valign="middle">
                            <p class="fieldname">Rent details (optional)*</p>
                        </td>
                        <td>
                            <input class="form-control" type="text" id="rent_details" name="rent_details" value="{{ data.listing.rent_details }}">
                        </td>
                    </tr>

                    <tr height="20px"></tr>
                    <tr>
                        <td width="150px" valign="middle">
                            <p class="fieldname">Property size (sq ft)*</p>
                        </td>
                        <td>
                            <input class="form-control" type="number" id="property_size" name="property_size" value="{{ data.listing.property_size }}" required>
                        </td>
                    </tr>

                    <tr height="20px"></tr>
                    <tr>
                        <td width="150px" valign="middle">
                            <p class="fieldname"># of roomies needed*</p>
                        </td>
                        <td>
                            <input class="form-control" type="number" id="number_roommates_needed" name="number_roommates_needed" value="{{ data.listing.number_roommates_needed }}" required>
                        </td>
                    </tr>

                    <tr height="20px"></tr>
                    <tr>
                        <td width="150px" valign="middle">
                            <p class="fieldname">Has gym*</p>
                        </td>
                        <td>
                            <input type="checkbox" ng-model="filterByAmenities['gym']" {% if data.preferences.amenities_gym == "true" %}checked{% endif %}>
                        </td>
                    </tr>

                    <tr height="20px"></tr>
                    <tr>
                        <td width="150px" valign="middle">
                            <p class="fieldname">Has pool*</p>
                        </td>
                        <td>
                            <input type="checkbox" ng-model="filterByAmenities['pool']" {% if data.preferences.amenities_pool == "true" %}checked{% endif %}>
                        </td>
                    </tr>

                    <tr height="20px"></tr>
                    <tr>
                        <td width="150px" valign="middle">
                            <p class="fieldname">Pet friendly*</p>
                        </td>
                        <td>
                            <input type="checkbox" ng-model="filterByAmenities['pet_friendly']" {% if data.preferences.amenities_pet_friendly == "true" %}checked{% endif %}>
                        </td>
                    </tr>

                    <tr height="20px"></tr>
                    <tr>
                        <td width="150px" valign="middle">
                            <p class="fieldname">Has computer room(s)*</p>
                        </td>
                        <td>
                            <input type="checkbox" ng-model="filterByAmenities['computer_room']" {% if data.preferences.amenities_computer_room == "true" %}checked{% endif %}>
                        </td>
                    </tr>

                    <tr height="20px"></tr>
                    <tr>
                        <td width="200px" valign="middle">
                            <p class="fieldname">Has trash pickup services*</p>
                        </td>
                        <td>
                            <input type="checkbox" ng-model="filterByAmenities['trash_pickup_services']" {% if data.preferences.amenities_trash_pickup_services == "true" %}checked{% endif %}>
                        </td>
                    </tr>

                    <tr height="20px"></tr>
                    <tr>
                        <td width="170px" valign="middle">
                            <p class="fieldname">Description (optional)</p>
                        </td>
                        <td>
                            <textarea class="form-control" name="bio" {% if not data.error %}placeholder="Write a short description of yourself. What's your major? How late do you sleep? Do you like quiet or noise?"{% endif %} rows="3">{% if data.error %}{{ data.profile.bio }}{% endif %}</textarea>
                        </td>
                    </tr>
                    <tr height="20px"></tr>
                    <tr>
                        <td width="150px" valign="middle">
                            <p class="fieldname">Photo (optional)</p>
                        </td>
                        <td>
                            <div id="preview">{% if data.profile.photo != None %}<a href="photos/{{ data.profile.photo }}"><img class="preview" src="photos/{{ data.profile.photo }}" /></a>{% endif %}</div>
                            <br/>
                            <input type="file" id="photo_upload" name="photo" onchange="handleFiles(this.files)">
                            <br/>
                            <div id="darklink"><div id="getfacebookpicture" class="{% if data.profile.facebook %}visible{% else %}hidden{% endif %}"><p class="text"><a onclick="getFacebookProfilePicture();" href="javascript:void(0);">Pull profile picture from Facebook</a></p></div></div>
                        </td>
                    </tr>
                </table>
                <br/><br/><br/>
                <p class="sectionheading">DEFAULT SEARCH PREFERENCES (OPTIONAL)</p>
                <table width="60%">
                    <tr>
                        <td>
                            <div id="darklink">
                                <p class="text">You can set default sorting and filtering preferences here if you like. These options only affect the default display of information in the <a href="/">main search interface</a>.</p>
                            </div>
                        </td>
                    </tr>
                </table>
                <br/>
                <table width="60%">
                    <tr>
                        <td width="150px" valign="middle">
                            <p class="text">Sorting preference</p>
                        </td>
                        <td>
                            <p class="text">This will set the default sorting order for apartment listings.</p>
                            <input type="radio" name="sorting_preference" value="distance" {% if data.preferences.sorting_preference == "distance" %}checked{% endif %}> Distance<br/>
                            <input type="radio" name="sorting_preference" value="rent" {% if data.preferences.sorting_preference == "rent" %}checked{% endif %}> Rent price<br/>
                            <input type="radio" name="sorting_preference" value="size" {% if data.preferences.sorting_preference == "size" %}checked{% endif %}> Property size<br/><br/>
                        </td>
                    </tr>
                    <tr>
                        <td width="150px" valign="middle">
                            <p class="text">Filtering preference</p>
                        </td>
                        <td>
                            <p class="text">This will set the default filtering options for apartment listings. Leave all unchecked to have no filters (e.g. default to display all listings).</p>
                            <input type="checkbox" name="filtering_preference_gym" value="gym" {% if data.preferences.amenities_gym == "true" %}checked{% endif %}> Has gym<br/>
                            <input type="checkbox" name="filtering_preference_pool" value="pool" {% if data.preferences.amenities_pool == "true" %}checked{% endif %}> Has pool<br/>
                            <input type="checkbox" name="filtering_preference_pet_friendly" value="pet_friendly" {% if data.preferences.amenities_pet_friendly == "true" %}checked{% endif %}> Is pet friendly<br/>
                            <input type="checkbox" name="filtering_preference_computer_room" value="computer_room" {% if data.preferences.amenities_computer_room == "true" %}checked{% endif %}> Has computer room(s)<br/>
                            <input type="checkbox" name="filtering_preference_trash_pickup_services" value="trash_pickup_services" {% if data.preferences.amenities_trash_pickup_services == "true" %}checked{% endif %}> Has trash pickup services<br/><br/>
                        </td>
                    </tr>
                </table>
                <br/><br/>
                <button type="submit" class="btn btn-primary btn-lg" name="my-form"><p class="button">update profile</p></button>
            </form>
        </div>

        <div id="footercontainer">
			<div id="footer">
            	<table width="100%">
                	<tr>
                    	<td>
                        	<p class="footer">A PROJECT OF RICE APPS, 2014</p>
                        </td>
                        <td>
                        	<p class="footer" align="right"><a href="/about">ABOUT ROOMMATE FINDER</a> | <a href="https://github.com/rice-apps/roommate-finder">GITHUB SOURCE</a> | <a href="http://riceapps.org">RICE APPS</a> | <a href="http://www.rice.edu">RICE UNIVERSITY</a></p>
                        </td>
                    </tr>
                </table>
			</div>
		</div>
	</body>
</html>